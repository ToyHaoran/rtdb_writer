# 写入器编译
```shell
#rm -rf rtdb_writer
go build -ldflags '-extldflags "-ldl"' -o rtdb_writer
```

# 帮助文档
```shell
./rtdb_writer static_write --help
```

# 写数插件部署到无网环境
下载go，解压到Linux，配置环境变量
vim /etc/profile.d/my_env.sh
export PATH=$PATH:/opt/software/go/bin
source /etc/profile
验证：go version

(在有网的机器上，在项目上的go.mod文件右键，运行go mod vendor，即将依赖复制到当前目录)
上传整个项目文件到Linux。
yum install -y gcc  # 需要提前安装
在plugin_example目录生成gowriter_plugin.so：go build -buildmode=c-shared -o gowrite_plugin.so
在writer目录生成最终文件：go build -ldflags '-extldflags "-ldl"' -o rtdb_writer
运行rtdb_writer命令即可

# 静态点写入

* 命令行示例
```shell
./rtdb_writer static_write \
  --plugin=../plugin_example/gowrite_plugin.so \
  --static_analog=../CSV20240614/1718350759143_HISTORY_NORMAL_STATIC_ANALOG.csv \
  --static_digital=../CSV20240614/1718350759143_HISTORY_NORMAL_STATIC_DIGITAL.csv \
  --unit_number=1 \
  --type=0 \
  --magic=10 \
  --param=static_write,xty111,6667,root,root,1000,3000,root.sg
```
--param=程序名,IP地址,端口,用户名,密码,sessionpool大小

2024/07/11 16:00:22 静态写入 - 开始时间: 2024-07-11T16:00:22+08:00, 结束时间: 2024-07-11T16:00:22+08:00
2024/07/11 16:00:22 总耗时: 11.474504ms, 机组数量: 1, 写入pnum数量: 100
登出数据库，结束程序，时间13ms

```shell
./rtdb_writer static_write \
  --plugin=../plugin_example/gowrite_plugin.so \
  --static_analog=../CSV20240614/1718350759143_REALTIME_NORMAL_STATIC_ANALOG.csv \
  --static_digital=../CSV20240614/1718350759143_REALTIME_NORMAL_STATIC_DIGITAL.csv \
  --unit_number=1 \
  --type=0 \
  --param=static_write,xty111,6667,root,root,4000,20000,root.sg
```
数据量巨大，容易OOM。
第一次运行：
2024/07/12 13:18:12 静态写入 - 开始时间: 2024-07-12T13:17:45+08:00, 结束时间: 2024-07-12T13:18:12+08:00
2024/07/12 13:18:12 总耗时: 26.767284717s, 机组数量: 1, 写入pnum数量: 199500
登出数据库，结束程序，耗时26769ms

第二次运行：
2024/07/12 13:19:42 静态写入 - 开始时间: 2024-07-12T13:19:36+08:00, 结束时间: 2024-07-12T13:19:42+08:00
2024/07/12 13:19:42 总耗时: 5.420654036s, 机组数量: 1, 写入pnum数量: 199500
登出数据库，结束程序，耗时5422ms



# 极速写入历史点

* 帮助文档
```shell
./rtdb_writer his_fast_write --help
```
* 命令行示例
* 3.2 并发查询一段时间历史存储值 参测厂商自行编写脚本导入历史数据集
* 3.3 并发查询一段时间等间隔插值 参测厂商自行编写脚本导入历史数据集
* 3.4 并发查询一段时间历史统计值 参测厂商自行编写脚本导入历史数据集
* 3.5 并发查询一段时间趋势曲线值 参测厂商自行编写脚本导入历史数据集
* 3.6 并发查询多点历史断面数据 参测厂商自行编写脚本导入历史数据集
* 3.7 数据压缩性能测试 参测厂商自行编写脚本导入历史数据集
* 4.1 高并发读写混合性能测试 参测厂商自行编写脚本导入历史数据集
* 5.7 多活能力 参测厂商自行编写脚本导入历史数据集
```shell
./rtdb_writer his_fast_write \
    --plugin=../plugin_example/gowrite_plugin.so \
    --his_normal_analog=../CSV20240614/1718350759143_HISTORY_NORMAL_ANALOG.csv \
    --his_normal_digital=../CSV20240614/1718350759143_HISTORY_NORMAL_DIGITAL.csv \
    --unit_number=1 \
    --random_av=false \
    --magic=10 \
    --param=his_fast_write,xty111,6667,root,root,4000,6000,root.sg
```
2024/07/12 11:36:28 极速写入历史值 - 开始时间: 2024-07-12T11:35:56+08:00, 结束时间: 2024-07-12T11:36:28+08:00
2024/07/12 11:36:28 总耗时: 32.122563696s, 断面数量: 8760, PNUM数量: 876000, 平均耗时: 3.666959ms,
最长耗时: 135.702293ms, 最短耗时: 2.407993ms, P99耗时: 5.278349ms, P95耗时: 4.256287ms, 中位数耗时: 3.600067ms
登出数据库，结束程序，耗时34401ms



# 周期性写入历史点

* 帮助文档
```shell
./rtdb_writer his_periodic_write --help
```
* 命令行示例
* 1.14 数据库健壮性测试 调用数据写入程序按历史数据的频率写入历史数据集
```shell
./rtdb_writer his_periodic_write  \
    --plugin=../plugin_example/gowrite_plugin.so \
    --his_normal_analog=../CSV20240614/1718350759143_HISTORY_NORMAL_ANALOG.csv \
    --his_normal_digital=../CSV20240614/1718350759143_HISTORY_NORMAL_DIGITAL.csv \
    --unit_number=1 \
    --random_av=false \
    --magic=10 \
    --param=his_periodic_write,xty111,6667,root,root,4000,5000,root.sg
```
2024/07/11 18:11:50 周期性写入历史值 - 开始时间: 2024-07-11T18:11:10+08:00, 结束时间: 2024-07-11T18:11:50+08:00
2024/07/11 18:11:50 总耗时: 581.234553ms, 睡眠耗时: 39.41533369s, 断面数量: 100, PNUM数量: 10000, 平均耗时: 5.812345ms,
最长耗时: 14.372356ms, 最短耗时: 4.561697ms, P99耗时: 7.582802ms, P95耗时: 6.697486ms, 中位数耗时: 5.717056ms


# 极速写入实时点
* 帮助文档
```shell
./rtdb_writer rt_fast_write --help
```
* 命令行示例
* 2.2 急速写入实时数据 调用数据写入程序急速写入实时数据集
* 2.4 急速写入PI数据 调用数据写入程序急速写入实时数据集
* 2.6 急速写入SOE数据 调用数据写入程序急速写入实时数据集
```shell
./rtdb_writer rt_fast_write \
    --plugin=../plugin_example/gowrite_plugin.so \
    --rt_fast_analog=../CSV20240614/1718350759143_REALTIME_FAST_ANALOG.csv \
    --rt_fast_digital=../CSV20240614/1718350759143_REALTIME_FAST_DIGITAL.csv \
    --rt_normal_analog=../CSV20240614/1718350759143_REALTIME_NORMAL_ANALOG.csv \
    --rt_normal_digital=../CSV20240614/1718350759143_REALTIME_NORMAL_DIGITAL.csv \
    --unit_number=1 \
    --mode=0 \
    --random_av=false \
    --magic=10 \
    --param=rt_fast_write,xty111,6667,root,root,5000,10000,root.sg
```
2024/07/12 11:34:10 极速写入实时值 - 开始时间: 2024-07-12T11:33:57+08:00, 结束时间: 2024-07-12T11:34:10+08:00
2024/07/12 11:34:10 快采点 - 总耗时: 4.965136648s, 断面数量: 399, PNUM数量: 199500, 平均耗时: 12.443951ms,
最长耗时: 31.099716ms, 最短耗时: 9.078344ms, P99耗时: 15.616426ms, P95耗时: 14.299159ms, 中位数耗时: 12.405174ms
2024/07/12 11:34:10 普通点 - 总耗时: 7.997327613s, 断面数量: 2, PNUM数量: 399000, 平均耗时: 3.998663806s,
最长耗时: 4.08217407s, 最短耗时: 3.915153543s, P99耗时: 4.08217407s, P95耗时: 4.08217407s, 中位数耗时: 3.915153543s
2024/07/12 11:34:10 写入总耗时: 12.962464261s
登出数据库，结束程序，耗时14979ms



# 周期性写入实时点
* 帮助文档
```shell
./rtdb_writer rt_periodic_write --help
```
* 命令行示例
* 1.17 跨单向网闸传输 调用数据写入程序的接口按实时数据的频率写入实时数据集
* 2.1 周期性写入实时数据 调用数据写入程序按实时数据的频率写入实时数据集
* 2.3 周期性写入PI数据 调用数据写入程序按实时数据的频率写入实时数据集
* 2.5 周期性写入SOE数据 调用数据写入程序按实时数据的频率写入实时数据集
* 2.7 数据库实时性测试 调用数据写入程序按实时数据的频率写入实时数据集
* 3.1 混合场景查询实时数据 调用数据写入程序的接口按实时数据的频率写入实时数据集
* 3.7 数据压缩性能测试 调用数据写入程序的接口按实时数据的频率写入实时数据集
* 4.1 高并发读写混合性能测试 调用数据写入程序的接口按实时数据的频率写入实时数据集
* 5.1 节点故障 调用数据写入程序的接口按实时数据的频率写入实时数据集
* 5.2 操作系统故障 调用数据写入程序的接口按实时数据的频率写入实时数据集
* 5.3 数据库服务故障 调用数据写入程序的接口按实时数据的频率写入实时数据集
* 5.4 过载保护 调用数据写入程序的接口按实时数据的频率写入实时数据集
* 5.5 数据多副本能力 调用数据写入程序的接口按实时数据的频率写入实时数据集
* 5.6 超大量数据处理 调用数据写入程序的接口按实时数据的频率写入实时数据集
```shell
./rtdb_writer rt_periodic_write \
    --plugin=../plugin_example/gowrite_plugin.so \
    --rt_fast_analog=../CSV20240614/1718350759143_REALTIME_FAST_ANALOG.csv \
    --rt_fast_digital=../CSV20240614/1718350759143_REALTIME_FAST_DIGITAL.csv \
    --rt_normal_analog=../CSV20240614/1718350759143_REALTIME_NORMAL_ANALOG.csv \
    --rt_normal_digital=../CSV20240614/1718350759143_REALTIME_NORMAL_DIGITAL.csv \
    --unit_number=2 \
    --overload_protection=true \
    --fast_cache=true \
    --mode=0 \
    --random_av=false \
    --magic=10 \
    --param=rt_periodic_write,xty111,6667,root,root,5000,8000,root.sg
```
(非并发)
2024/07/12 12:09:59 周期性写入实时值(开启载保护, 开启快采点缓存) - 开始时间: 2024-07-12T12:09:02+08:00, 结束时间: 2024-07-12T12:09:59+08:00
2024/07/12 12:09:59 快采点 - 总耗时: 6.899303437s, 睡眠耗时: 0s, 断面数量: 399, PNUM数量: 199500,
平均耗时: 17.291487ms ,最长耗时: 2.038372559s, 最短耗时: 1.260433969s, P99耗时: 2.038372559s, P95耗时: 2.038372559s, 中位数耗时: 1.722551743s
2024/07/12 12:09:59 普通点 - 总耗时: 56.647036921s, 睡眠耗时: 0s, 断面数量: 2, PNUM数量: 399000,
平均耗时: 28.32351846s ,最长耗时: 32.379605966s, 最短耗时: 24.267430955s, P99耗时: 32.379605966s, P95耗时: 32.379605966s, 中位数耗时: 24.267430955s
登出数据库，结束程序，耗时58650ms

(批量写并发)
周期性写入实时值(开启载保护, 开启快采点缓存) - 开始时间: 2024-07-12T12:29:49+08:00, 结束时间: 2024-07-12T12:30:47+08:00
2024/07/12 12:30:47 快采点 - 总耗时: 3.292753559s, 睡眠耗时: 0s, 断面数量: 399, PNUM数量: 199500,
平均耗时: 8.252515ms ,最长耗时: 1.786457849s, 最短耗时: 159.765977ms, P99耗时: 1.786457849s, P95耗时: 1.786457849s, 中位数耗时: 175.371189ms
2024/07/12 12:30:47 普通点 - 总耗时: 57.763600552s, 睡眠耗时: 0s, 断面数量: 2, PNUM数量: 399000,
平均耗时: 28.881800276s ,最长耗时: 32.696425328s, 最短耗时: 25.067175224s, P99耗时: 32.696425328s, P95耗时: 32.696425328s, 中位数耗时: 25.067175224s
登出数据库，结束程序，耗时59810ms


# 备注
该文档的所有shell示例macos上均可正常运行, 在linux平台上需要重新设置插件路径

因:  macos平台插件是以```.dylib```结尾, 而linux平台插件是以```.so```结尾