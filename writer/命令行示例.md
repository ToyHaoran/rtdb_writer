# 写入器编译
```shell
./build.sh
```

# 部署到无网环境
下载go，解压到Linux，配置环境变量
vim /etc/profile.d/my_env.sh
export PATH=$PATH:/opt/pro/go/go1.21.4/bin
source /etc/profile
验证：go version

(在有网的机器上，在项目上的go.mod文件右键，运行go mod vendor，即将依赖复制到当前目录)
上传整个项目文件到Linux。
在plugin_example目录生成gowriter.so：go build -buildmode=c-shared -o gowrite_plugin.so
在writer目录生成最终文件：go build -ldflags '-extldflags "-ldl"' -o rtdb_writer
运行rtdb_writer

```shell
./rtdb_writer static_write \
--plugin=../plugin_example/gowrite_plugin.so \
--static_analog=../CSV20240614/1718350759143_HISTORY_NORMAL_STATIC_ANALOG.csv \
--static_digital=../CSV20240614/1718350759143_HISTORY_NORMAL_STATIC_DIGITAL.csv \
--unit_number=1 \
--param=static_write,192.168.150.100,6667,root,root,1000,root.sg
```

# 静态点写入
* 帮助文档
```shell
./rtdb_writer static_write --help
```
* 命令行示例
```shell
./rtdb_writer static_write \
  --plugin=../plugin_example/gowrite_plugin.so \
  --static_analog=../CSV20240614/1718350759143_HISTORY_NORMAL_STATIC_ANALOG.csv \
  --static_digital=../CSV20240614/1718350759143_HISTORY_NORMAL_STATIC_DIGITAL.csv \
  --unit_number=2 \
  --is_fast=false \
  --param=static_write,192.168.150.100,6667,root,root,1000,root.sg
```
--param=程序名,IP地址,端口,用户名,密码,sessionpool大小

静态写入 - 开始时间: 2024-07-09T10:21:17+08:00, 结束时间: 2024-07-09T10:21:17+08:00
总耗时: 25.508075ms, 机组数量: 2, 写入pnum数量: 100
登出数据库，结束程序，时间27ms


# 极速写入历史点

* 帮助文档
```shell
./rtdb_writer his_fast_write --help
```
* 命令行示例
```shell
./rtdb_writer his_fast_write \
    --plugin=../plugin_example/gowrite_plugin.so \
    --his_normal_analog=../CSV20240614/1718350759143_HISTORY_NORMAL_ANALOG.csv \
    --his_normal_digital=../CSV20240614/1718350759143_HISTORY_NORMAL_DIGITAL.csv \
    --unit_number=1 \
    --param=his_fast_write,192.168.150.100,6667,root,root,1000,root.sg
```
极速写入历史值 - 开始时间: 2024-07-09T10:18:55+08:00, 结束时间: 2024-07-09T10:20:11+08:00
总耗时: 1m16.324119308s, 断面数量: 8760, PNUM数量: 876000, 平均耗时: 8.712799ms,
最长耗时: 493.264315ms, 最短耗时: 2.017583ms, P99耗时: 43.907251ms, P95耗时: 30.6332ms, 中位数耗时: 4.275347ms
登出数据库，结束程序，时间78623ms

# 周期性写入历史点

* 帮助文档
```shell
./rtdb_writer his_periodic_write --help
```
* 命令行示例
```shell
./rtdb_writer his_periodic_write  \
    --plugin=../plugin_example/gowrite_plugin.so \
    --his_normal_analog=../CSV20240614/1718350759143_HISTORY_NORMAL_ANALOG.csv \
    --his_normal_digital=../CSV20240614/1718350759143_HISTORY_NORMAL_DIGITAL.csv \
    --unit_number=1 \
    --param=his_periodic_write,192.168.150.100,6667,root,root,1000,root.sg
```
周期性写入历史值 - 开始时间: 2024-07-09T10:21:47+08:00, 结束时间: 2024-07-09T10:22:49+08:00
总耗时: 796.084417ms, 睡眠耗时: 1m1.60113561s, 断面数量: 156, PNUM数量: 15600, 平均耗时: 5.103105ms,
最长耗时: 18.233318ms, 最短耗时: 3.322232ms, P99耗时: 17.621446ms, P95耗时: 7.3655 4.790438ms
登出数据库，结束程序，时间64514m


# 极速写入实时点

* 帮助文档
```shell
./rtdb_writer rt_fast_write --help
```
* 命令行示例
```shell
./rtdb_writer rt_fast_write \
    --plugin=../plugin_example/gowrite_plugin.so \
    --rt_fast_analog=../CSV20240614/1718350759143_REALTIME_FAST_ANALOG.csv \
    --rt_fast_digital=../CSV20240614/1718350759143_REALTIME_FAST_DIGITAL.csv \
    --rt_normal_analog=../CSV20240614/1718350759143_REALTIME_NORMAL_ANALOG.csv \
    --rt_normal_digital=../CSV20240614/1718350759143_REALTIME_NORMAL_DIGITAL.csv \
    --unit_number=1 \
    --mode=0 \
    --param=rt_fast_write,192.168.150.100,6667,root,root,1000,root.sg
```
极速写入实时值 - 开始时间: 2024-07-09T10:23:18+08:00, 结束时间: 2024-07-09T10:23:26+08:00
快采点 - 总耗时: 3.522700404s, 断面数量: 399, PNUM数量: 199500, 平均耗时: 8.828823ms,
最长耗时: 1.08436393s, 最短耗时: 3.535707ms, P99耗时: 43.800643ms, P95耗时: 7.8802 5.371177ms
普通点 - 总耗时: 4.639995225s, 断面数量: 2, PNUM数量: 399000, 平均耗时: 2.319997612s,
最长耗时: 2.417271489s, 最短耗时: 2.222723736s, P99耗时: 2.417271489s, P95耗时: 2.中位数耗时: 2.222723736s
写入总耗时: 8.162695629s
登出数据库，结束程序，时间10176ms


# 周期性写入实时点
* 帮助文档
```shell
./rtdb_writer rt_periodic_write --help
```
* 命令行示例
```shell
./rtdb_writer rt_periodic_write \
    --plugin=../plugin_example/gowrite_plugin.so \
    --rt_fast_analog=../CSV20240614/1718350759143_REALTIME_FAST_ANALOG.csv \
    --rt_fast_digital=../CSV20240614/1718350759143_REALTIME_FAST_DIGITAL.csv \
    --rt_normal_analog=../CSV20240614/1718350759143_REALTIME_NORMAL_ANALOG.csv \
    --rt_normal_digital=../CSV20240614/1718350759143_REALTIME_NORMAL_DIGITAL.csv \
    --unit_number=1 \
    --overload_protection=false \
    --fast_cache=false \
    --mode=0 \
    --param=rt_periodic_write,192.168.150.100,6667,root,root,1000,root.sg
```
登录数据库，运行rt_periodic_write
周期性写入实时值(关闭载保护, 关闭快采点缓存) - 开始时间: 2024-07-09T10:24:45+08:00, 结束时间: 2024-07-09T10:24:50+08:00
快采点 - 总耗时: 5.12730573s, 睡眠耗时: 0s, 断面数量: 399, PNUM数量: 199500,
平均耗时: 12.85039ms ,最长耗时: 470.520697ms, 最短耗时: 3.554633ms, P99耗时: 196.8: 31.117126ms, 中位数耗时: 6.90676ms
常规点 - 总耗时: 4.68900623s, 睡眠耗时: 0s, 断面数量: 2, PNUM数量: 399000,
平均耗时: 2.344503115s ,最长耗时: 2.361803322s, 最短耗时: 2.327202908s, P99耗时: 295耗时: 2.361803322s, 中位数耗时: 2.327202908s
登出数据库，结束程序，时间7142ms

# 备注
该文档的所有shell示例macos上均可正常运行, 在linux平台上需要重新设置插件路径

因:  macos平台插件是以```.dylib```结尾, 而linux平台插件是以```.so```结尾